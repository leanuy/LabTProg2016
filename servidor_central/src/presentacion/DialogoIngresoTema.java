package presentacion;

import java.io.File;
import java.io.IOException;
import javax.swing.JFileChooser;
import javax.swing.JOptionPane;

/**
 *
 * @author leandro
 */
public class DialogoIngresoTema extends javax.swing.JDialog {

    private String pathATema; 
    private File selectedFile;
    
    /**
     * Creates new form DialogoIngresoTema
     */
    public DialogoIngresoTema(java.awt.Frame parent, String tittle, boolean modal) {
        super(parent, modal);
        initComponents();
        urlDelTema.setEnabled(false);
        urlaTemaRadioButton.setSelected(false);
        this.setTitle(tittle);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panelIngresoTemas = new javax.swing.JPanel();
        urlaTemaRadioButton = new javax.swing.JRadioButton();
        urlDelTema = new javax.swing.JTextField();
        urlLabel = new javax.swing.JLabel();
        aceptarButton = new javax.swing.JButton();
        cancelarButton = new javax.swing.JButton();
        nombreTema = new javax.swing.JTextField();
        nombreLabel = new javax.swing.JLabel();
        pathLocal = new javax.swing.JTextField();
        pathLabel = new javax.swing.JLabel();
        examinarButton = new javax.swing.JButton();
        duracionLabel = new javax.swing.JLabel();
        duracionTextField = new javax.swing.JTextField();

        urlaTemaRadioButton.setText("Ingresar link al tema");
        urlaTemaRadioButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                urlaTemaRadioButtonActionPerformed(evt);
            }
        });

        urlLabel.setText("URL:");

        aceptarButton.setText("Aceptar");
        aceptarButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                aceptarButtonActionPerformed(evt);
            }
        });

        cancelarButton.setText("Cancelar");
        cancelarButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelarButtonActionPerformed(evt);
            }
        });

        nombreLabel.setText("Nombre del Tema");

        pathLabel.setText("Path local");

        examinarButton.setText("Examinar");
        examinarButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                examinarButtonActionPerformed(evt);
            }
        });

        duracionLabel.setText("Duracion");

        javax.swing.GroupLayout panelIngresoTemasLayout = new javax.swing.GroupLayout(panelIngresoTemas);
        panelIngresoTemas.setLayout(panelIngresoTemasLayout);
        panelIngresoTemasLayout.setHorizontalGroup(
            panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(panelIngresoTemasLayout.createSequentialGroup()
                    .addGap(0, 23, Short.MAX_VALUE)
                    .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                        .addGroup(panelIngresoTemasLayout.createSequentialGroup()
                            .addComponent(nombreLabel)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(nombreTema, javax.swing.GroupLayout.PREFERRED_SIZE, 341, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGroup(panelIngresoTemasLayout.createSequentialGroup()
                            .addComponent(pathLabel)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(pathLocal, javax.swing.GroupLayout.PREFERRED_SIZE, 385, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(examinarButton)
                    .addGap(50, 50, 50))
                .addGroup(panelIngresoTemasLayout.createSequentialGroup()
                    .addGap(77, 77, 77)
                    .addComponent(duracionLabel)
                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                    .addComponent(duracionTextField, javax.swing.GroupLayout.PREFERRED_SIZE, 66, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGroup(panelIngresoTemasLayout.createSequentialGroup()
                    .addGap(23, 23, 23)
                    .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(urlaTemaRadioButton)
                        .addGroup(panelIngresoTemasLayout.createSequentialGroup()
                            .addComponent(urlLabel)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(urlDelTema)
                            .addGap(141, 141, 141)))))
            .addGroup(panelIngresoTemasLayout.createSequentialGroup()
                .addGap(240, 240, 240)
                .addComponent(aceptarButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(cancelarButton)
                .addGap(14, 14, 14))
        );
        panelIngresoTemasLayout.setVerticalGroup(
            panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, panelIngresoTemasLayout.createSequentialGroup()
                .addGap(41, 41, 41)
                .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(nombreTema, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(nombreLabel))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(duracionLabel)
                    .addComponent(duracionTextField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(4, 4, 4)
                .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(pathLocal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(pathLabel)
                    .addComponent(examinarButton))
                .addGap(12, 12, 12)
                .addComponent(urlaTemaRadioButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(urlDelTema, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(urlLabel))
                .addGap(18, 18, 18)
                .addGroup(panelIngresoTemasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(aceptarButton)
                    .addComponent(cancelarButton))
                .addContainerGap(10, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(panelIngresoTemas, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(panelIngresoTemas, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void urlaTemaRadioButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_urlaTemaRadioButtonActionPerformed
        if (urlaTemaRadioButton.isSelected()) {
            urlDelTema.setEnabled(true);
            pathLocal.setEnabled(false);
        } else {
            urlDelTema.setEnabled(false);
            pathLocal.setEnabled(true);
        }
    }//GEN-LAST:event_urlaTemaRadioButtonActionPerformed

    private void cancelarButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelarButtonActionPerformed
        AltaAlbum.cargarTema(false, null, null, null, 0, false);
        this.dispose();
    }//GEN-LAST:event_cancelarButtonActionPerformed

    private void aceptarButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_aceptarButtonActionPerformed
        int duration = 0;
        try {
            duration = Integer.parseInt(duracionTextField.getText());
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Duracion invalida", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }
        if ("".equals(nombreTema.getText())) {
            JOptionPane.showMessageDialog(this, "Nombre de tema vacio", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }
        if (urlaTemaRadioButton.isSelected()) {
            if ("".equals(urlDelTema.getText())) {
                JOptionPane.showMessageDialog(this, "Link al tema vacio", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }
            AltaAlbum.cargarTema(true, urlDelTema.getText(), null, nombreTema.getText(), duration, true);
            this.dispose();
        } else {
            if ("".equals(pathLocal.getText())) {
                JOptionPane.showMessageDialog(this, "Cargue un tema", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }
            AltaAlbum.cargarTema(false, "", selectedFile, nombreTema.getText(), duration, true);
            this.dispose();
        }
    }//GEN-LAST:event_aceptarButtonActionPerformed

    private void examinarButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_examinarButtonActionPerformed
        JFileChooser fChooser = new JFileChooser();
        this.getContentPane().add(fChooser);
        fChooser.setVisible(true);
        
        int selected = fChooser.showDialog(this, "Seleccionar");
        if (selected == JFileChooser.APPROVE_OPTION) {
            File file = fChooser.getSelectedFile();
            try {
                pathATema = file.getCanonicalPath();
                String ext = getExtension(file);
                if (!"mp3".equals(ext)) {
                    JOptionPane.showMessageDialog(this, "Debe seleccionar un archivo formato .mp3", "Error", JOptionPane.ERROR_MESSAGE);
                    fChooser.setVisible(false);
                    return;
                }
                pathLocal.setText(pathATema);
                selectedFile = file;
            } catch (IOException ex) {
                JOptionPane.showMessageDialog(this, "La ruta al archivo no es correcta", "Error", JOptionPane.ERROR_MESSAGE);
            }
        }
        fChooser.setVisible(false);
    }//GEN-LAST:event_examinarButtonActionPerformed

    private String getExtension(File file) {
        String ext = null;
        String nomArchivo = file.getName();
        int idx = nomArchivo.lastIndexOf('.');
        if (idx > 0 &&  idx < nomArchivo.length() - 1) {
            ext = nomArchivo.substring(idx + 1).toLowerCase();
        }
        return ext;
    }
    

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton aceptarButton;
    private javax.swing.JButton cancelarButton;
    private javax.swing.JLabel duracionLabel;
    private javax.swing.JTextField duracionTextField;
    private javax.swing.JButton examinarButton;
    private javax.swing.JLabel nombreLabel;
    private javax.swing.JTextField nombreTema;
    private javax.swing.JPanel panelIngresoTemas;
    private javax.swing.JLabel pathLabel;
    private javax.swing.JTextField pathLocal;
    private javax.swing.JTextField urlDelTema;
    private javax.swing.JLabel urlLabel;
    private javax.swing.JRadioButton urlaTemaRadioButton;
    // End of variables declaration//GEN-END:variables
}
